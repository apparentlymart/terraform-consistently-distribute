module "t" {
  source = "../.."

  hosts = ["a1", "a2", "a3"]
  guests = [
    for x in range(1, 256) : format("b%03d", x)
  ]
}

locals {
  host_guests = tomap({
    for g, h in module.t.guest_hosts : h => g...
  })
  host_counts = tomap({
    for h, gs in local.host_guests : h => length(gs)
  })
}

resource "test_assertions" "result" {
  component = "result"

  equal "guest_hosts" {
    description = "guest_hosts"

    got = module.t.guest_hosts
    want = tomap({
      "b001" = "a3"
      "b002" = "a3"
      "b003" = "a3"
      "b004" = "a1"
      "b005" = "a3"
      "b006" = "a3"
      "b007" = "a3"
      "b008" = "a3"
      "b009" = "a3"
      "b010" = "a3"
      "b011" = "a2"
      "b012" = "a3"
      "b013" = "a3"
      "b014" = "a3"
      "b015" = "a3"
      "b016" = "a3"
      "b017" = "a2"
      "b018" = "a3"
      "b019" = "a3"
      "b020" = "a3"
      "b021" = "a2"
      "b022" = "a2"
      "b023" = "a2"
      "b024" = "a3"
      "b025" = "a3"
      "b026" = "a3"
      "b027" = "a3"
      "b028" = "a3"
      "b029" = "a3"
      "b030" = "a3"
      "b031" = "a3"
      "b032" = "a3"
      "b033" = "a3"
      "b034" = "a2"
      "b035" = "a1"
      "b036" = "a3"
      "b037" = "a3"
      "b038" = "a2"
      "b039" = "a2"
      "b040" = "a2"
      "b041" = "a3"
      "b042" = "a3"
      "b043" = "a2"
      "b044" = "a2"
      "b045" = "a2"
      "b046" = "a1"
      "b047" = "a3"
      "b048" = "a3"
      "b049" = "a3"
      "b050" = "a3"
      "b051" = "a3"
      "b052" = "a3"
      "b053" = "a3"
      "b054" = "a3"
      "b055" = "a3"
      "b056" = "a2"
      "b057" = "a3"
      "b058" = "a2"
      "b059" = "a3"
      "b060" = "a3"
      "b061" = "a3"
      "b062" = "a3"
      "b063" = "a2"
      "b064" = "a2"
      "b065" = "a3"
      "b066" = "a3"
      "b067" = "a3"
      "b068" = "a3"
      "b069" = "a2"
      "b070" = "a3"
      "b071" = "a2"
      "b072" = "a3"
      "b073" = "a3"
      "b074" = "a3"
      "b075" = "a2"
      "b076" = "a3"
      "b077" = "a1"
      "b078" = "a3"
      "b079" = "a3"
      "b080" = "a3"
      "b081" = "a3"
      "b082" = "a3"
      "b083" = "a3"
      "b084" = "a3"
      "b085" = "a2"
      "b086" = "a3"
      "b087" = "a3"
      "b088" = "a3"
      "b089" = "a1"
      "b090" = "a2"
      "b091" = "a3"
      "b092" = "a3"
      "b093" = "a3"
      "b094" = "a3"
      "b095" = "a3"
      "b096" = "a2"
      "b097" = "a2"
      "b098" = "a2"
      "b099" = "a2"
      "b100" = "a3"
      "b101" = "a1"
      "b102" = "a3"
      "b103" = "a3"
      "b104" = "a2"
      "b105" = "a3"
      "b106" = "a1"
      "b107" = "a3"
      "b108" = "a3"
      "b109" = "a3"
      "b110" = "a2"
      "b111" = "a2"
      "b112" = "a3"
      "b113" = "a1"
      "b114" = "a3"
      "b115" = "a3"
      "b116" = "a3"
      "b117" = "a3"
      "b118" = "a3"
      "b119" = "a2"
      "b120" = "a3"
      "b121" = "a3"
      "b122" = "a3"
      "b123" = "a3"
      "b124" = "a2"
      "b125" = "a3"
      "b126" = "a1"
      "b127" = "a3"
      "b128" = "a3"
      "b129" = "a2"
      "b130" = "a3"
      "b131" = "a3"
      "b132" = "a3"
      "b133" = "a3"
      "b134" = "a3"
      "b135" = "a2"
      "b136" = "a2"
      "b137" = "a2"
      "b138" = "a3"
      "b139" = "a3"
      "b140" = "a3"
      "b141" = "a3"
      "b142" = "a2"
      "b143" = "a3"
      "b144" = "a3"
      "b145" = "a3"
      "b146" = "a3"
      "b147" = "a3"
      "b148" = "a3"
      "b149" = "a3"
      "b150" = "a2"
      "b151" = "a3"
      "b152" = "a3"
      "b153" = "a3"
      "b154" = "a3"
      "b155" = "a2"
      "b156" = "a3"
      "b157" = "a3"
      "b158" = "a2"
      "b159" = "a3"
      "b160" = "a3"
      "b161" = "a2"
      "b162" = "a3"
      "b163" = "a3"
      "b164" = "a3"
      "b165" = "a2"
      "b166" = "a2"
      "b167" = "a3"
      "b168" = "a3"
      "b169" = "a3"
      "b170" = "a2"
      "b171" = "a3"
      "b172" = "a2"
      "b173" = "a2"
      "b174" = "a3"
      "b175" = "a2"
      "b176" = "a2"
      "b177" = "a3"
      "b178" = "a3"
      "b179" = "a3"
      "b180" = "a3"
      "b181" = "a3"
      "b182" = "a3"
      "b183" = "a3"
      "b184" = "a2"
      "b185" = "a2"
      "b186" = "a2"
      "b187" = "a3"
      "b188" = "a3"
      "b189" = "a2"
      "b190" = "a3"
      "b191" = "a2"
      "b192" = "a3"
      "b193" = "a3"
      "b194" = "a2"
      "b195" = "a2"
      "b196" = "a2"
      "b197" = "a3"
      "b198" = "a3"
      "b199" = "a3"
      "b200" = "a3"
      "b201" = "a3"
      "b202" = "a3"
      "b203" = "a3"
      "b204" = "a2"
      "b205" = "a2"
      "b206" = "a2"
      "b207" = "a3"
      "b208" = "a3"
      "b209" = "a3"
      "b210" = "a2"
      "b211" = "a3"
      "b212" = "a2"
      "b213" = "a3"
      "b214" = "a3"
      "b215" = "a3"
      "b216" = "a3"
      "b217" = "a3"
      "b218" = "a3"
      "b219" = "a3"
      "b220" = "a3"
      "b221" = "a3"
      "b222" = "a3"
      "b223" = "a3"
      "b224" = "a3"
      "b225" = "a2"
      "b226" = "a3"
      "b227" = "a3"
      "b228" = "a2"
      "b229" = "a2"
      "b230" = "a3"
      "b231" = "a2"
      "b232" = "a3"
      "b233" = "a3"
      "b234" = "a3"
      "b235" = "a3"
      "b236" = "a2"
      "b237" = "a3"
      "b238" = "a3"
      "b239" = "a3"
      "b240" = "a3"
      "b241" = "a3"
      "b242" = "a3"
      "b243" = "a3"
      "b244" = "a2"
      "b245" = "a3"
      "b246" = "a3"
      "b247" = "a3"
      "b248" = "a3"
      "b249" = "a3"
      "b250" = "a3"
      "b251" = "a3"
      "b252" = "a2"
      "b253" = "a3"
      "b254" = "a2"
      "b255" = "a3"
    })
  }

  equal "host_counts" {
    description = "host_counts"

    # NOTE: This clearly isn't distributed very well! Suggests this
    # algorithm needs more work.
    got = local.host_counts
    want = tomap({
      "a1" = 9
      "a2" = 67
      "a3" = 179
    })
  }
}

terraform {
  required_version = "~> 1.1.0"

  required_providers {
    test = {
      source = "terraform.io/builtin/test"
    }
  }
}
